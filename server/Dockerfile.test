FROM node:22-alpine

WORKDIR /app

# sqlite3 CLI is needed for schema setup in tests
RUN apk add --no-cache sqlite

# Install all deps, including devDependencies (nodemon, etc.)
COPY server/package*.json ./
RUN npm install --no-audit --no-fund

COPY server/ ./

CMD ["npm", "test"]
